<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>花費追蹤器</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="一個可愛的每日花費追蹤應用程式，幫助您管理日常開支">
    <meta name="theme-color" content="#7c3aed">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="花費追蹤器">
    <meta name="msapplication-TileColor" content="#7c3aed">
    <meta name="msapplication-config" content="browserconfig.xml">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-192x192.png">
    
    <!-- Stylesheets -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    
    <!-- Scripts -->
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="character.js"></script>
    <script src="script.js"></script>
</head>

<body class="bg-gradient-to-br from-yellow-50 via-amber-50 to-orange-50 min-h-screen p-4">
    <div class="max-w-6xl mx-auto pb-20 md:pb-0" x-data="expenseTracker()" x-init="init()">
        <!-- 通知系統 -->
        <div x-show="notification.show" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform translate-y-2"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 transform translate-y-0"
             x-transition:leave-end="opacity-0 transform translate-y-2"
             class="fixed top-4 left-4 right-4 md:left-auto md:right-4 md:max-w-sm z-50">
            <div class="rounded-lg shadow-lg p-4" 
                 :class="{
                     'bg-green-100 border border-green-200 text-green-800': notification.type === 'success',
                     'bg-red-100 border border-red-200 text-red-800': notification.type === 'error',
                     'bg-blue-100 border border-blue-200 text-blue-800': notification.type === 'info'
                 }">
                <div class="flex items-center justify-between">
                    <span x-html="notification.message"></span>
                    <button @click="hideNotification()" class="ml-2 text-lg">&times;</button>
                </div>
            </div>
        </div>

        <!-- 手機版固定底部角色狀態 -->
        <div class="md:hidden fixed bottom-0 left-0 right-0 z-40 mobile-character-fixed" x-show="userName && dailyBudget > 0">
            <!-- 收合狀態 -->
            <div x-show="!mobileCharacterExpanded" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-full"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-y-0"
                 x-transition:leave-end="opacity-0 transform translate-y-full"
                 class="bg-white border-t-2 border-purple-200 shadow-lg">
                <button @click="mobileCharacterExpanded = true" 
                        class="w-full p-3 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-purple-200">
                            <img :src="currentCharacterImage" alt="Character" class="w-full h-full object-cover">
                        </div>
                        <div class="text-left">
                            <div class="text-sm font-bold text-purple-800" x-text="userName"></div>
                            <div class="text-xs text-purple-600" x-text="`${percentage}% 已花費`"></div>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="text-lg" x-text="characterStatus.emoji"></div>
                        <div class="text-purple-500">▲</div>
                    </div>
                </button>
            </div>

            <!-- 展開狀態 -->
            <div x-show="mobileCharacterExpanded" 
                 x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 transform translate-y-full"
                 x-transition:enter-end="opacity-100 transform translate-y-0"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 transform translate-y-0"
                 x-transition:leave-end="opacity-0 transform translate-y-full"
                 class="bg-white border-t-2 border-purple-200 shadow-lg max-h-96 overflow-y-auto mobile-character-expanded">
                <!-- 標題列 -->
                <div class="p-3 border-b border-purple-100 flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-purple-200">
                            <img :src="currentCharacterImage" alt="Character" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <div class="text-sm font-bold text-purple-800" x-text="userName"></div>
                            <div class="text-xs text-purple-600">角色狀態</div>
                        </div>
                    </div>
                    <button @click="mobileCharacterExpanded = false" 
                            class="text-purple-500 text-lg">▼</button>
                </div>

                <!-- 角色內容 -->
                <div class="p-4 space-y-3">
                    <!-- 角色圖片 -->
                    <div class="text-center">
                        <div class="character-animation inline-block" :class="{ 'shake': level >= 7, 'panic': level >= 10 }">
                            <img :src="currentCharacterImage" alt="Character Expression" class="w-24 h-24 object-contain">
                        </div>
                    </div>

                    <!-- 狀態指示器 -->
                    <div class="bg-white rounded-xl p-3 border-2" 
                         :class="{
                             'border-green-200 bg-green-50': characterStatus.color === 'green',
                             'border-yellow-200 bg-yellow-50': characterStatus.color === 'yellow',
                             'border-orange-200 bg-orange-50': characterStatus.color === 'orange',
                             'border-red-200 bg-red-50': characterStatus.color === 'red',
                             'border-purple-200 bg-purple-50': characterStatus.color === 'purple'
                         }">
                        <div class="text-center">
                            <div class="text-lg font-bold mb-1" 
                                 :class="{
                                     'text-green-700': characterStatus.color === 'green',
                                     'text-yellow-700': characterStatus.color === 'yellow',
                                     'text-orange-700': characterStatus.color === 'orange',
                                     'text-red-700': characterStatus.color === 'red',
                                     'text-purple-700': characterStatus.color === 'purple'
                                 }">
                                <span x-text="characterStatus.emoji"></span> 
                                <span x-text="characterStatus.status"></span>
                            </div>
                            <div class="text-xs" 
                                 :class="{
                                     'text-green-600': characterStatus.color === 'green',
                                     'text-yellow-600': characterStatus.color === 'yellow',
                                     'text-orange-600': characterStatus.color === 'orange',
                                     'text-red-600': characterStatus.color === 'red',
                                     'text-purple-600': characterStatus.color === 'purple'
                                 }">
                                花費比例：<span x-text="percentage"></span>%
                                <span x-show="percentage > 100" class="text-red-600 font-bold"> (超支)</span>
                            </div>
                        </div>
                    </div>

                    <!-- 預算資訊 -->
                    <div class="bg-purple-50 rounded-xl p-3">
                        <div class="text-xs text-purple-600 mb-2 text-center">預算狀態</div>
                        <div class="space-y-1 text-xs">
                            <div class="flex justify-between">
                                <span class="text-purple-600">預算上限</span>
                                <span class="text-purple-600 font-medium" x-text="`${dailyBudget}元`"></span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-red-600">已花費</span>
                                <span class="text-red-600 font-medium" x-text="`${totalSpent}元`"></span>
                            </div>
                            <div class="flex justify-between" :class="remainingAmount === 0 ? 'text-red-600' : 'text-green-600'">
                                <span>剩餘預算</span>
                                <span class="font-medium" x-text="`${remainingAmount}元`"></span>
                            </div>
                        </div>
                        <!-- 進度條 -->
                        <div class="mt-2">
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="h-2 rounded-full progress-bar" 
                                     :style="`width: ${Math.min(percentage, 100)}%`" 
                                     :class="{ 
                                         'bg-green-500': percentage < 50, 
                                         'bg-yellow-500': percentage >= 50 && percentage < 90, 
                                         'bg-red-500': percentage >= 90, 
                                         'pulse-red': percentage >= 100 
                                     }"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 激勵語句 -->
                    <div class="bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl p-3">
                        <div class="text-xs text-purple-800 text-center" x-text="currentQuote"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-purple-800 mb-2">💰 花費追蹤器 💰</h1>
            <p class="text-purple-600">陪你管理每日花費</p>
            
            <!-- PWA 安裝按鈕 -->
            <div x-show="showInstallButton && !isPWA" class="mt-4">
                <button @click="installApp()" 
                        class="bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 text-white px-6 py-2 rounded-full font-medium transition-all shadow-lg">
                    📱 安裝應用程式
                </button>
            </div>
            
            <!-- PWA 狀態指示器 -->
            <div x-show="isPWA" class="mt-2">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    📱 應用程式模式
                </span>
            </div>
            
            <!-- 離線狀態指示器 -->
            <div x-show="!isOnline" class="mt-2">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                    📡 離線模式
                </span>
            </div>
        </div>

        <div class="bg-pink-50 rounded-3xl shadow-lg p-4 md:p-6 mb-8">
            <div class="space-y-2 md:hidden">
                <div>
                    <button @click="activeTab = activeTab === 'info' ? null : 'info'" class="w-full bg-purple-100 text-purple-800 font-bold p-3 rounded-lg flex justify-between items-center">
                        <span>📊 個人與預算資訊</span>
                        <span x-show="activeTab !== 'info'">▼</span>
                        <span x-show="activeTab === 'info'">▲</span>
                    </button>
                    <div x-show="activeTab === 'info'" x-collapse class="p-2">
                        <div class="h-full flex flex-col space-y-3">
                            <div class="bg-yellow-50 rounded-xl p-4 flex flex-col">
                                <div class="text-sm font-medium text-yellow-800 mb-3 text-center">個人資訊</div>
                                <div class="space-y-2 flex-shrink-0 mb-3">
                                    <input type="text" placeholder="請輸入姓名" x-model="userInput.name" @keydown.enter="setUserInfo" class="w-full px-3 py-2 border border-yellow-200 rounded-lg focus:border-yellow-400 focus:outline-none text-sm">
                                    <input type="number" placeholder="請設定每日預算" x-model.number="userInput.budget" @keydown.enter="setUserInfo" class="w-full px-3 py-2 border border-yellow-200 rounded-lg focus:border-yellow-400 focus:outline-none text-sm">
                                    <button @click="setUserInfo" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg font-medium text-sm transition-all">設定</button>
                                    <button @click="clearAllData" class="w-full bg-red-400 hover:bg-red-500 text-white px-3 py-2 rounded-lg font-medium text-sm transition-all mt-2">🗑️ 清除所有資料</button>
                                </div>
                                <div x-show="userName && dailyBudget > 0" x-transition:enter="bounce-in" class="flex-1 flex flex-col justify-center">
                                    <div class="bg-purple-100 rounded-xl p-3">
                                        <div class="text-center">
                                            <div class="text-purple-800 font-medium mb-2">
                                                <div class="text-sm">👋 <span x-text="userName"></span></div>
                                            </div>
                                            <div class="text-purple-700">
                                                <div class="text-xs mb-1">今日預算</div>
                                                <div class="text-sm font-bold">💰 <span x-text="dailyBudget"></span> 元</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-blue-50 rounded-xl p-3 flex-1">
                                <div class="text-sm font-medium text-blue-800 mb-2 text-center">預算狀態</div>
                                <div class="space-y-1 text-sm">
                                    <div class="flex items-center justify-between">
                                        <span class="text-blue-600">預算上限</span>
                                        <span class="text-blue-600 font-medium"><span x-text="dailyBudget"></span> 元</span>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-red-600">已花費</span>
                                        <span class="text-red-600 font-medium"><span x-text="totalSpent"></span> 元</span>
                                    </div>
                                    <div class="flex items-center justify-between" :class="remainingAmount === 0 ? 'text-red-600' : 'text-green-600'">
                                        <span>剩餘預算</span>
                                        <span class="font-medium"><span x-text="remainingAmount"></span> 元</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <button @click="activeTab = activeTab === 'character' ? null : 'character'" class="w-full bg-purple-100 text-purple-800 font-bold p-3 rounded-lg flex justify-between items-center">
                        <span>🐰 角色狀態</span>
                        <span x-show="activeTab !== 'character'">▼</span>
                        <span x-show="activeTab === 'character'">▲</span>
                    </button>
                    <div x-show="activeTab === 'character'" x-collapse class="p-2">
                         <div class="character-animation text-center" :class="{ 'shake': level >= 7, 'panic': level >= 10 }">
                            <div class="mb-4 space-y-2">
                                <div class="bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl p-3">
                                    <div class="text-purple-800 font-bold text-sm">
                                        <span x-text="userName || '請先設定個人資訊'"></span>
                                    </div>
                                    <div class="text-purple-600 text-xs">每日預算：<span x-text="dailyBudget" class="font-medium"></span> 元</div>
                                </div>
                                <div class="bg-yellow-100 rounded-xl p-2">
                                    <div class="text-orange-600 text-xs font-medium">☀️ 美好的一天就從早餐開始！</div>
                                </div>
                                <!-- 角色狀態指示器 -->
                                <div class="bg-white rounded-xl p-2 border-2" 
                                     :class="{
                                         'border-green-200 bg-green-50': characterStatus.color === 'green',
                                         'border-yellow-200 bg-yellow-50': characterStatus.color === 'yellow',
                                         'border-orange-200 bg-orange-50': characterStatus.color === 'orange',
                                         'border-red-200 bg-red-50': characterStatus.color === 'red',
                                         'border-purple-200 bg-purple-50': characterStatus.color === 'purple'
                                     }">
                                    <div class="text-xs font-bold" 
                                         :class="{
                                             'text-green-700': characterStatus.color === 'green',
                                             'text-yellow-700': characterStatus.color === 'yellow',
                                             'text-orange-700': characterStatus.color === 'orange',
                                             'text-red-700': characterStatus.color === 'red',
                                             'text-purple-700': characterStatus.color === 'purple'
                                         }">
                                        <span x-text="characterStatus.emoji"></span> 
                                        <span x-text="characterStatus.status"></span>
                                        <span x-show="percentage > 100" class="text-red-600"> (超支 <span x-text="percentage"></span>%)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="relative inline-block flex items-center justify-center">
                                <img :src="currentCharacterImage" alt="Character Expression" class="max-w-full max-h-full object-contain">
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <button @click="activeTab = activeTab === 'stats' ? null : 'stats'" class="w-full bg-purple-100 text-purple-800 font-bold p-3 rounded-lg flex justify-between items-center">
                        <span>📈 花費統計</span>
                        <span x-show="activeTab !== 'stats'">▼</span>
                        <span x-show="activeTab === 'stats'">▲</span>
                    </button>
                    <div x-show="activeTab === 'stats'" x-collapse class="p-2">
                        <div class="h-full flex flex-col space-y-3">
                            <div class="bg-green-50 rounded-xl p-3">
                                <h3 class="text-sm font-bold text-green-800 text-center mb-3">花費統計</h3>
                                <div class="space-y-2 h-full flex flex-col justify-center">
                                    <div class="flex items-center justify-between bg-white rounded-lg p-2"><span>🍽️</span><span class="font-bold text-orange-600" x-text="`${categoryTotals.food}元`"></span></div>
                                    <div class="flex items-center justify-between bg-white rounded-lg p-2"><span>🚌</span><span class="font-bold text-blue-600" x-text="`${categoryTotals.transport}元`"></span></div>
                                    <div class="flex items-center justify-between bg-white rounded-lg p-2"><span>🎮</span><span class="font-bold text-purple-600" x-text="`${categoryTotals.entertainment}元`"></span></div>
                                    <div class="flex items-center justify-between bg-white rounded-lg p-2"><span>🧴</span><span class="font-bold text-green-600" x-text="`${categoryTotals.daily}元`"></span></div>
                                </div>
                            </div>
                            <div class="bg-red-100 rounded-xl p-3 flex-shrink-0">
                                <div class="flex items-center justify-between"><span class="text-sm font-bold text-red-800">總計</span><span class="text-sm font-bold text-red-600" x-text="`${totalSpent}元`"></span></div>
                                <div class="mt-2 text-xs text-red-600 text-center">佔預算比例：<span class="font-medium" x-text="`${percentage}%`"></span></div>
                                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                                    <div class="h-2.5 rounded-full progress-bar" :style="`width: ${Math.min(percentage, 100)}%`" :class="{ 'bg-green-500': percentage < 50, 'bg-yellow-500': percentage >= 50 && percentage < 90, 'bg-red-500': percentage >= 90, 'pulse-red': percentage >= 100 }"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="hidden md:grid grid-cols-1 md:grid-cols-3 gap-4 items-stretch min-h-[400px]">
                <div class="h-full flex flex-col space-y-3">
                    <div class="bg-yellow-50 rounded-xl p-4 flex flex-col">
                        <div class="text-sm font-medium text-yellow-800 mb-3 text-center">個人資訊</div>
                        <div class="space-y-2 flex-shrink-0 mb-3">
                            <input type="text" placeholder="請輸入姓名" x-model="userInput.name" @keydown.enter="setUserInfo" class="w-full px-3 py-2 border border-yellow-200 rounded-lg focus:border-yellow-400 focus:outline-none text-sm">
                            <input type="number" placeholder="請設定每日預算" x-model.number="userInput.budget" @keydown.enter="setUserInfo" class="w-full px-3 py-2 border border-yellow-200 rounded-lg focus:border-yellow-400 focus:outline-none text-sm">
                            <button @click="setUserInfo" class="w-full bg-purple-500 hover:bg-purple-600 text-white px-3 py-2 rounded-lg font-medium text-sm transition-all">設定</button>
                            <button @click="clearAllData" class="w-full bg-red-400 hover:bg-red-500 text-white px-3 py-2 rounded-lg font-medium text-sm transition-all mt-2">🗑️ 清除所有資料</button>
                        </div>
                        <div x-show="userName && dailyBudget > 0" x-transition:enter="bounce-in" class="flex-1 flex flex-col justify-center">
                            <div class="bg-purple-100 rounded-xl p-3">
                                <div class="text-center">
                                    <div class="text-purple-800 font-medium mb-2">
                                        <div class="text-sm">👋 <span x-text="userName"></span></div>
                                    </div>
                                    <div class="text-purple-700">
                                        <div class="text-xs mb-1">今日預算</div>
                                        <div class="text-sm font-bold">💰 <span x-text="dailyBudget"></span> 元</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-xl p-3 flex-1">
                        <div class="text-sm font-medium text-blue-800 mb-2 text-center">預算狀態</div>
                        <div class="space-y-1 text-sm">
                            <div class="flex items-center justify-between">
                                <span class="text-blue-600">預算上限</span>
                                <span class="text-blue-600 font-medium"><span x-text="dailyBudget"></span> 元</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-red-600">已花費</span>
                                <span class="text-red-600 font-medium"><span x-text="totalSpent"></span> 元</span>
                            </div>
                            <div class="flex items-center justify-between" :class="remainingAmount === 0 ? 'text-red-600' : 'text-green-600'">
                                <span>剩餘預算</span>
                                <span class="font-medium"><span x-text="remainingAmount"></span> 元</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="character-animation text-center" :class="{ 'shake': level >= 7, 'panic': level >= 10 }">
                    <div class="mb-4 space-y-2">
                        <div class="bg-gradient-to-r from-pink-100 to-purple-100 rounded-xl p-3">
                            <div class="text-purple-800 font-bold text-sm">
                                <span x-text="userName || '請先設定個人資訊'"></span>
                            </div>
                            <div class="text-purple-600 text-xs">每日預算：<span x-text="dailyBudget" class="font-medium"></span> 元</div>
                        </div>
                        <div class="bg-yellow-100 rounded-xl p-2">
                            <div class="text-orange-600 text-xs font-medium">☀️ 美好的一天就從早餐開始！</div>
                        </div>
                        <!-- 角色狀態指示器 -->
                        <div class="bg-white rounded-xl p-2 border-2" 
                             :class="{
                                 'border-green-200 bg-green-50': characterStatus.color === 'green',
                                 'border-yellow-200 bg-yellow-50': characterStatus.color === 'yellow',
                                 'border-orange-200 bg-orange-50': characterStatus.color === 'orange',
                                 'border-red-200 bg-red-50': characterStatus.color === 'red',
                                 'border-purple-200 bg-purple-50': characterStatus.color === 'purple'
                             }">
                            <div class="text-xs font-bold" 
                                 :class="{
                                     'text-green-700': characterStatus.color === 'green',
                                     'text-yellow-700': characterStatus.color === 'yellow',
                                     'text-orange-700': characterStatus.color === 'orange',
                                     'text-red-700': characterStatus.color === 'red',
                                     'text-purple-700': characterStatus.color === 'purple'
                                 }">
                                <span x-text="characterStatus.emoji"></span> 
                                <span x-text="characterStatus.status"></span>
                                <span x-show="percentage > 100" class="text-red-600"> (超支 <span x-text="percentage"></span>%)</span>
                            </div>
                        </div>
                    </div>
                    <div class="relative inline-block flex items-center justify-center">
                        <img :src="currentCharacterImage" alt="Character Expression" class="max-w-full max-h-full object-contain">
                    </div>
                </div>
                <div class="h-full flex flex-col space-y-3">
                    <div class="bg-green-50 rounded-xl p-3">
                        <h3 class="text-sm font-bold text-green-800 text-center mb-3">花費統計</h3>
                        <div class="space-y-2 h-full flex flex-col justify-center">
                            <div class="flex items-center justify-between bg-white rounded-lg p-2"><span>🍽️</span><span class="font-bold text-orange-600" x-text="`${categoryTotals.food}元`"></span></div>
                            <div class="flex items-center justify-between bg-white rounded-lg p-2"><span>🚌</span><span class="font-bold text-blue-600" x-text="`${categoryTotals.transport}元`"></span></div>
                            <div class="flex items-center justify-between bg-white rounded-lg p-2"><span>🎮</span><span class="font-bold text-purple-600" x-text="`${categoryTotals.entertainment}元`"></span></div>
                            <div class="flex items-center justify-between bg-white rounded-lg p-2"><span>🧴</span><span class="font-bold text-green-600" x-text="`${categoryTotals.daily}元`"></span></div>
                        </div>
                    </div>
                    <div class="bg-red-100 rounded-xl p-3 flex-shrink-0">
                        <div class="flex items-center justify-between"><span class="text-sm font-bold text-red-800">總計</span><span class="text-sm font-bold text-red-600" x-text="`${totalSpent}元`"></span></div>
                        <div class="mt-2 text-xs text-red-600 text-center">佔預算比例：<span class="font-medium" x-text="`${percentage}%`"></span></div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="h-2.5 rounded-full progress-bar" :style="`width: ${Math.min(percentage, 100)}%`" :class="{ 'bg-green-500': percentage < 50, 'bg-yellow-500': percentage >= 50 && percentage < 90, 'bg-red-500': percentage >= 90, 'pulse-red': percentage >= 100 }"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-lg p-6 mb-8">
            <div class="bg-gradient-to-r from-pink-100 to-purple-100 rounded-2xl p-6 text-center">
                <p class="text-sm font-medium text-purple-800" x-text="currentQuote"></p>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-lg p-6 mt-8">
            <h3 class="text-sm font-bold text-purple-800 mb-4 text-center">💳 記錄花費</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
                <select x-model="newExpense.category" class="px-4 py-3 border-2 border-purple-200 rounded-2xl focus:border-purple-400 focus:outline-none">
                    <option value="">選擇類別</option>
                    <option value="food">🍽️ 餐飲</option>
                    <option value="transport">🚌 交通</option>
                    <option value="entertainment">🎮 娛樂</option>
                    <option value="daily">🧴 日用品</option>
                </select>
                <input type="text" placeholder="花費細節 (如：早餐、捷運票)" x-model="newExpense.description" class="px-4 py-3 border-2 border-purple-200 rounded-2xl focus:border-purple-400 focus:outline-none">
                <input type="number" placeholder="金額" x-model.number="newExpense.amount" @keydown.enter="addExpense" class="px-4 py-3 border-2 border-purple-200 rounded-2xl focus:border-purple-400 focus:outline-none">
                <button @click="addExpense" class="bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white px-6 py-3 rounded-2xl font-medium transition-all">新增 ✨</button>
            </div>
        </div>

        <div class="bg-white rounded-3xl shadow-lg p-6 mt-8">
            <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4 gap-2">
                <h3 class="text-sm font-bold text-purple-800">📝 今日花費記錄</h3>
                <div class="flex gap-2">
                    <button @click="exportCSV()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-xs transition-all flex-1 md:flex-none">📊 匯出 CSV</button>
                    
                    <!-- Google Sheets Export -->
                    <template x-if="isGapiLoaded && isGisLoaded">
                        <div>
                            <button x-show="!isSignedIn" @click="handleAuthClick()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs transition-all flex-1 md:flex-none">🚀 登入並匯出至 Google Sheet</button>
                            <div x-show="isSignedIn" class="flex gap-2">
                                <button @click="exportToSheet()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-xs transition-all flex-1 md:flex-none">🚀 匯出至 Google Sheet</button>
                                <button @click="handleSignoutClick()" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded-lg text-xs transition-all flex-1 md:flex-none">登出</button>
                            </div>
                        </div>
                    </template>
                    <template x-if="!isGapiLoaded || !isGisLoaded">
                        <button class="bg-gray-400 text-white px-3 py-1 rounded-lg text-xs transition-all flex-1 md:flex-none" disabled>正在載入 Google API...</button>
                    </template>
                </div>
            </div>
            <div class="space-y-2">
                <template x-if="expenses.length === 0">
                    <p class="text-gray-500 text-center py-8">還沒有任何花費記錄喔～</p>
                </template>
                <template x-for="expense in expenses" :key="expense.id">
                    <div class="bg-gray-50 rounded-xl p-4 bounce-in">
                        <template x-if="editingExpenseId !== expense.id">
                            <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-2">
                                <div class="flex items-center gap-3">
                                    <span class="text-lg" x-text="expense.icon"></span>
                                    <div class="flex-1">
                                        <div class="font-medium text-purple-800 text-sm" x-text="expense.description"></div>
                                        <div class="text-xs text-purple-600" x-text="expense.categoryName"></div>
                                        <div class="text-xs text-gray-500" x-text="expense.timestamp ? new Date(expense.timestamp).toLocaleString('zh-TW') : ''"></div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between md:justify-end gap-3">
                                    <div class="text-sm font-bold text-red-500" x-text="`-${expense.amount}元`"></div>
                                    <div class="flex gap-2">
                                        <button @click="editExpense(expense)" class="text-blue-500 hover:text-blue-700 text-xs px-2 py-1 rounded hover:bg-blue-50">✏️</button>
                                        <button @click="deleteExpense(expense.id)" class="text-red-500 hover:text-red-700 text-xs px-2 py-1 rounded hover:bg-red-50">🗑️</button>
                                    </div>
                                </div>
                            </div>
                        </template>
                        <template x-if="editingExpenseId === expense.id">
                            <div class="flex items-center gap-3">
                                <div class="flex-1 space-y-2">
                                    <input type="text" x-model="editedExpense.description" class="w-full px-3 py-1 border border-purple-200 rounded-lg text-sm">
                                    <input type="number" x-model.number="editedExpense.amount" class="w-full px-3 py-1 border border-purple-200 rounded-lg text-sm">
                                </div>
                                <div class="flex flex-col gap-2">
                                    <button @click="updateExpense()" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-lg text-xs">儲存</button>
                                    <button @click="cancelEdit()" class="bg-gray-400 hover:bg-gray-500 text-white px-3 py-1 rounded-lg text-xs">取消</button>
                                </div>
                            </div>
                        </template>
                    </div>
                </template>
            </div>
        </div>
    <footer class="text-center py-6">
            <a href="./privacy-policy.html" class="text-sm text-purple-600 hover:text-purple-800 underline">隱私權政策</a>
        </footer>
    </div>
</body>

</html>